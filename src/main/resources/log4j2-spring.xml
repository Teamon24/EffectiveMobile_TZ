<Configuration status="WARN" monitorInterval="30">
    <Properties>
        <Property name="LOG_PATTERN">%d{[yyyy-MM-dd HH:mm:ss.SSSZ]} %p %m%n</Property>
        <Property name="FILE_SIZE_THRESHOLD">2500KB</Property>
        <Property name="FILE_NAME_PATTERN">%d{yyyy-MM-dd HH.mm.ss}</Property>
        <Property name="LOG_DIR">logs</Property>
        <Property name="APPLICATION_LOG_PREFIX">app</Property>
    </Properties>

    <Appenders>
        <Console name="stdout" target="SYSTEM_OUT" follow="true">
            <PatternLayout pattern="${LOG_PATTERN}"/>
        </Console>

        <RollingFile name="stdoutFile"
                     fileName="${LOG_DIR}/stdout.log"
                     filePattern="${LOG_DIR}/stdout-${FILE_NAME_PATTERN}.log.gz">
            <LevelRangeFilter minLevel="FATAL"
                              maxLevel="ALL"
                              onMatch="ACCEPT"
                              onMismatch="DENY"/>
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies><SizeBasedTriggeringPolicy size="${FILE_SIZE_THRESHOLD}"/></Policies>
            <DefaultRolloverStrategy max="10"/>
        </RollingFile>

        <RollingFile name="debugLog"
                     fileName="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.debug.log"
                     filePattern="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.debug-${FILE_NAME_PATTERN}.log.gz">
            <LevelRangeFilter minLevel="DEBUG"
                              maxLevel="DEBUG"
                              onMatch="ACCEPT"
                              onMismatch="DENY"/>
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies><SizeBasedTriggeringPolicy size="${FILE_SIZE_THRESHOLD}"/></Policies>
            <DefaultRolloverStrategy max="10"/>
        </RollingFile>

        <RollingFile name="infoLog"
                     fileName="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.info.log"
                     filePattern="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.info-${FILE_NAME_PATTERN}.log.gz">
            <LevelRangeFilter minLevel="WARN" maxLevel="INFO" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies><SizeBasedTriggeringPolicy size="${FILE_SIZE_THRESHOLD}"/></Policies>
            <DefaultRolloverStrategy max="10"/>
        </RollingFile>

        <RollingFile name="errorLog"
                     fileName="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.error.log"
                     filePattern="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.error-${FILE_NAME_PATTERN}.log.gz">
            <LevelRangeFilter minLevel="ERROR" maxLevel="ERROR" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies>
                <SizeBasedTriggeringPolicy size="${FILE_SIZE_THRESHOLD}"/>
            </Policies>
            <DefaultRolloverStrategy max="10"/>
        </RollingFile>

        <RollingFile name="apiLog"
                     fileName="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.api.log"
                     filePattern="${LOG_DIR}/${APPLICATION_LOG_PREFIX}.api-${FILE_NAME_PATTERN}.log.gz">
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies><SizeBasedTriggeringPolicy size="${FILE_SIZE_THRESHOLD}"/></Policies>
            <DefaultRolloverStrategy max="1"/>
        </RollingFile>

        <RollingFile name="databaseLog"
                     fileName="${LOG_DIR}/hibernate.log"
                     filePattern="${LOG_DIR}/hibernate-${FILE_NAME_PATTERN}.log.gz">
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies><SizeBasedTriggeringPolicy size="${FILE_SIZE_THRESHOLD}"/></Policies>
            <DefaultRolloverStrategy max="1"/>
        </RollingFile>

        <Socket name="logstash" host="localhost" port="5000">
            <JsonLayout properties="true"/>
        </Socket>

        <Failover name="logstashFailover" primary="logstash" ignoreExceptions="false">
            <Failovers><AppenderRef ref="logstashFailoverFile" /></Failovers>
        </Failover>

        <RollingFile name="logstashFailoverFile"
                     fileName="${LOG_DIR}/logstashFailoverFile.log"
                     filePattern="${LOG_DIR}/logstashFailoverFile-${FILE_NAME_PATTERN}.log.gz"
                     bufferedIO="true" ignoreExceptions="false">
            <PatternLayout charset="UTF-8" pattern="${LOG_PATTERN}"/>
            <Policies><SizeBasedTriggeringPolicy size="${FILE_SIZE_THRESHOLD}" /></Policies>
        </RollingFile>
    </Appenders>

    <Loggers>
        <AsyncLogger name="org.effective_mobile.task_management_system.logging.HttpExchangeLoggingInterceptor" additivity="false">
            <AppenderRef ref="apiLog"/>
        </AsyncLogger>

        <AsyncLogger name="org.hibernate" level="ALL" additivity="false">
            <AppenderRef ref="databaseLog"/>
        </AsyncLogger>

        <AsyncLogger name="org.effective_mobile.task_management_system" additivity="false">
            <AppenderRef ref="debugLog"/>
            <AppenderRef ref="infoLog"/>
            <AppenderRef ref="errorLog"/>
        </AsyncLogger>

        <AsyncLogger name="logstashLogger" level="ALL" additivity="false">
            <AppenderRef ref="logstash"/>
        </AsyncLogger>

        <Root level="DEBUG">
            <AppenderRef ref="stdout"/>
            <AppenderRef ref="stdoutFile"/>
        </Root>
    </Loggers>
</Configuration>